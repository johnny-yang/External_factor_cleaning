name_list[[1]][2]
raw_data[[9]][1]
raw_data[[9]][11]
for (i in 1:length(Newdata[[1]])){
for (t in 1:length(raw_data[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
for (l in 1:length(name_list)){
if (name_list[[1]][l]==temp_col){
if (cal>=0&cal<=6){
Newdata[[sequence[l]]][i]<-1
}
}
}
}
}
View(Newdata)
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
for (l in 1:length(name_list)){
if (name_list[[1]][l]==temp_col){
if (cal>=0&cal<=6){
Newdata[[sequence[l]]][i]<-1
}
}
}
}
}
View(Newdata)
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
for (l in 1:length(name_list)){
if (name_list[[1]][l]==temp_col){
if (cal>=0&cal<=6){
Newdata[[(sequence[l])]][i]<-1
}
}
}
}
}
View(Newdata)
name_list
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
for (l in 1:length(name_list)){
if (name_list[[1]][l]==temp_col&cal>=0&cal<=6){
num<-sequence[l]
Newdata[[num]][i]<-1
}
}
}
}
View(raw_data)
View(Newdata)
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
message(temp_col)
for (l in 1:length(name_list)){
if (name_list[[1]][l]==temp_col&cal>=0&cal<=6){
num<-sequence[l]
Newdata[[num]][i]<-1
}
}
}
}
View(Newdata)
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
for (l in 1:length(name_list)){
if (name_list[[1]][l]==temp_col&cal>=0&cal<=6){
num<-sequence[l]
message(num)
Newdata[[num]][i]<-1
}
}
}
}
temp_col
name_list[[1]][1]==temp_col
name_list[[1]][2]==temp_col
name_list[[1]][3]==temp_col
View(raw_data)
cal<-raw_data[[2]][t]-Newdata[[1]][i]
cal
raw_data[[2]][t]
View(raw_data)
Newdata[[1]][i]
temp_col
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
for (l in 1:length(name_list)){
if (cal>=0&cal<=6){
message(i)
if (name_list[[1]][l]==temp_col&){
num<-sequence[l]
message(num)
Newdata[[num]][i]<-1
}
}
}
}
}
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
for (l in 1:length(name_list)){
if (cal>=0&cal<=6){
message(i)
if (name_list[[1]][l]==temp_col&) {
num<-sequence[l]
message(num)
Newdata[[num]][i]<-1
}
}
}
}
}
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
for (l in 1:length(name_list)){
if (cal>=0&cal<=6){
message(i)
if (name_list[[1]][l]==temp_col) {
num<-sequence[l]
message(num)
Newdata[[num]][i]<-1
}
}
}
}
}
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
for (l in 1:length(name_list)){
if (cal>=0&cal<=6){
message(t,i)
if (name_list[[1]][l]==temp_col) {
num<-sequence[l]
message(num)
Newdata[[num]][i]<-1
}
}
}
}
}
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
for (l in 1:length(name_list)){
if (cal>=0&cal<=6){
message("t=",t," and ","i = ", i)
if (name_list[[1]][l]==temp_col) {
num<-sequence[l]
message(num)
Newdata[[num]][i]<-1
}
}
}
}
}
t<-162
i <- 379
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
for (l in 1:length(name_list)){
if (cal>=0&cal<=6){
message("t<-",t," , ","i<-", i , " l <-",l )
if (name_list[[1]][l]==temp_col) {
num<-sequence[l]
Newdata[[num]][i]<-1
}
}
}
}
}
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
for (l in 1:length(name_list)){
if (cal>=0&cal<=6){
message("t<-",t," , ","i<-", i , ", l <-",l )
if (name_list[[1]][l]==temp_col) {
num<-sequence[l]
Newdata[[num]][i]<-1
}
}
}
}
}
num<-sequence[l]
t<-162 , i<-379, l <-1
t<-162
View(Newdata)
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
if (cal>=0&cal<=6){
for (l in 1:length(name_list)){
message("t<-",t," , ","i<-", i , ", l <-",l )
if (name_list[[1]][l]==temp_col) {
num<-sequence[l]
Newdata[[num]][i]<-1
}
}
}
}
}
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
if (cal>=0&cal<=6){
for (l in 1:length(name_list[[1]])){
message("t<-",t," , ","i<-", i , ", l <-",l )
if (name_list[[1]][l]==temp_col) {
num<-sequence[l]
Newdata[[num]][i]<-1
}
}
}
}
}
raw_data<-Initialization()
raw_data<-filter(raw_data,`Country.x`=="China")
raw_data<-arrange(raw_data,Date)
name_list<-select(raw_data,c(3,9))%>%distinct()
raw_data$count<-0
len<-length(names(raw_data))
for (i in 1:len){
raw_data[[i]]<-trimws(raw_data[[i]],"l")
raw_data[[i]]<-trimws(raw_data[[i]],"r")
}
name_list[[1]]<-trimws(name_list[[1]],"l")
name_list[[1]]<-trimws(name_list[[1]],"r")
raw_data<-distinct(raw_data)
name_list<-distinct(name_list)
raw_data<-na.omit(raw_data)
name_list<-na.omit(name_list)
name_list<-select(name_list,-1) %>% distinct()
raw_data<-arrange(raw_data,Holiday.x,Date)
for (i in 2:length(raw_data[[1]])){
if (raw_data[[2]][i]==(as.Date(raw_data[[2]][i-1])+1)&raw_data[[9]][i]==raw_data[[9]][i-1]){
raw_data[[10]][i]<-as.numeric(raw_data[[10]][i-1])+1
}
}
raw_data$Final_name<-"-"
for (m in 1:length(raw_data[[1]])){
if (raw_data[[10]][m]==0){
raw_data[[11]][m]<-raw_data[[9]][m]
}else{
raw_data[[11]][m]<-paste0(raw_data[[9]][m],"_P",raw_data[[10]][m])}
}
New_date<-seq.Date(as.Date(begin_data),as.Date("2020-01-01"),"week")
Newdata<-as.data.frame(New_date)
New_names<-c("Date")
New_list<-c()
for (i in 1:length(name_list[[1]])){
Temp<-name_list[[1]][i]
Temp_PRE<-paste(name_list[[1]][i],"PRE",sep = "_")
Temp_POST<-paste(name_list[[1]][i],"POST",sep = "_")
New_list<-c(New_list,Temp_PRE)
New_list<-c(New_list,Temp)
New_list<-c(New_list,Temp_POST)
New_names<-c(New_names,Temp_PRE)
New_names<-c(New_names,Temp)
New_names<-c(New_names,Temp_POST)
}
for (i in 1:length(New_list)){
Newdata[[1+i]]<-0
New_names[i+1]<-New_list[i]
}
names(Newdata)<-New_names
sequence<-c()
for (i in 1:length(New_names)){
for (t in 1:length(name_list[[1]])){
if (New_names[i]==name_list[[1]][t]){
sequence<-c(sequence,i)
}
}
}
raw_data$Date<-as.Date(raw_data$Date)
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
if (cal>=0&cal<=6){
for (l in 1:length(name_list[[1]])){
if (name_list[[1]][l]==temp_col) {
num<-sequence[l]
Newdata[[num]][i]<-1
}
}
}
}
}
View(Newdata)
View(raw_data)
name_list
for (i in 1:length(Newdata[[1]])){
for (t in 1:length(name_list[[1]])){
if (Newdata[[sequence[t]]][i]==1){
Newdata[[sequence[t]+1]][i+1]<-1
Newdata[[sequence[t]-1]][i-1]<-1
}
}
}
View(Newdata)
source('~/External_factor_cleaning/Function.R', echo=TRUE)
View(Holiday_data_cleaning)
source('~/External_factor_cleaning/Function.R', echo=TRUE)
e<-Holiday_data_cleaning("China",Developer = T,Date_option=T,"")
Data_for_write<-data_filter_CN_week(raw_data,name_list,begin_data)
source('~/External_factor_cleaning/Function.R', echo=TRUE)
Data_for_write<-data_filter_CN_week(raw_data,name_list,begin_data)
data_filter_CN_week<-function(raw_data,name_list,begin_data){
raw_data<-Initialization()
raw_data<-filter(raw_data,`Country.x`=="China")
raw_data<-arrange(raw_data,Date)
name_list<-select(raw_data,c(3,9))%>%distinct()
raw_data$count<-0
len<-length(names(raw_data))
for (i in 1:len){
raw_data[[i]]<-trimws(raw_data[[i]],"l")
raw_data[[i]]<-trimws(raw_data[[i]],"r")
}
name_list[[1]]<-trimws(name_list[[1]],"l")
name_list[[1]]<-trimws(name_list[[1]],"r")
raw_data<-distinct(raw_data)
name_list<-distinct(name_list)
raw_data<-na.omit(raw_data)
name_list<-na.omit(name_list)
name_list<-select(name_list,-1) %>% distinct()
raw_data<-arrange(raw_data,Holiday.x,Date)
for (i in 2:length(raw_data[[1]])){
if (raw_data[[2]][i]==(as.Date(raw_data[[2]][i-1])+1)&raw_data[[9]][i]==raw_data[[9]][i-1]){
raw_data[[10]][i]<-as.numeric(raw_data[[10]][i-1])+1
}
}
raw_data$Final_name<-"-"
for (m in 1:length(raw_data[[1]])){
if (raw_data[[10]][m]==0){
raw_data[[11]][m]<-raw_data[[9]][m]
}else{
raw_data[[11]][m]<-paste0(raw_data[[9]][m],"_P",raw_data[[10]][m])}
}
New_date<-seq.Date(as.Date(begin_data),as.Date("2020-01-01"),"week")
Newdata<-as.data.frame(New_date)
New_names<-c("Date")
New_list<-c()
for (i in 1:length(name_list[[1]])){
Temp<-name_list[[1]][i]
Temp_PRE<-paste(name_list[[1]][i],"PRE",sep = "_")
Temp_POST<-paste(name_list[[1]][i],"POST",sep = "_")
New_list<-c(New_list,Temp_PRE)
New_list<-c(New_list,Temp)
New_list<-c(New_list,Temp_POST)
New_names<-c(New_names,Temp_PRE)
New_names<-c(New_names,Temp)
New_names<-c(New_names,Temp_POST)
}
for (i in 1:length(New_list)){
Newdata[[1+i]]<-0
New_names[i+1]<-New_list[i]
}
names(Newdata)<-New_names
sequence<-c()
for (i in 1:length(New_names)){
for (t in 1:length(name_list[[1]])){
if (New_names[i]==name_list[[1]][t]){
sequence<-c(sequence,i)
}
}
}
raw_data$Date<-as.Date(raw_data$Date)
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
if (cal>=0&cal<=6){
for (l in 1:length(name_list[[1]])){
if (name_list[[1]][l]==temp_col) {
num<-sequence[l]
Newdata[[num]][i]<-1
}
}
}
}
}
for (i in 1:length(Newdata[[1]])){
for (t in 1:length(name_list[[1]])){
if (Newdata[[sequence[t]]][i]==1){
Newdata[[sequence[t]+1]][i+1]<-1
Newdata[[sequence[t]-1]][i-1]<-1
}
}
}
return(Newdata)
}
data_filter_CN_week<-function(raw_data,name_list,begin_data){
raw_data<-Initialization()
raw_data<-filter(raw_data,`Country.x`=="China")
raw_data<-arrange(raw_data,Date)
name_list<-select(raw_data,c(3,9))%>%distinct()
raw_data$count<-0
len<-length(names(raw_data))
for (i in 1:len){
raw_data[[i]]<-trimws(raw_data[[i]],"l")
raw_data[[i]]<-trimws(raw_data[[i]],"r")
}
name_list[[1]]<-trimws(name_list[[1]],"l")
name_list[[1]]<-trimws(name_list[[1]],"r")
raw_data<-distinct(raw_data)
name_list<-distinct(name_list)
raw_data<-na.omit(raw_data)
name_list<-na.omit(name_list)
name_list<-select(name_list,-1) %>% distinct()
raw_data<-arrange(raw_data,Holiday.x,Date)
for (i in 2:length(raw_data[[1]])){
if (raw_data[[2]][i]==(as.Date(raw_data[[2]][i-1])+1)&raw_data[[9]][i]==raw_data[[9]][i-1]){
raw_data[[10]][i]<-as.numeric(raw_data[[10]][i-1])+1
}
}
raw_data$Final_name<-"-"
for (m in 1:length(raw_data[[1]])){
if (raw_data[[10]][m]==0){
raw_data[[11]][m]<-raw_data[[9]][m]
}else{
raw_data[[11]][m]<-paste0(raw_data[[9]][m],"_P",raw_data[[10]][m])}
}
New_date<-seq.Date(as.Date(begin_data),as.Date("2020-01-01"),"week")
Newdata<-as.data.frame(New_date)
New_names<-c("Date")
New_list<-c()
for (i in 1:length(name_list[[1]])){
Temp<-name_list[[1]][i]
Temp_PRE<-paste(name_list[[1]][i],"PRE",sep = "_")
Temp_POST<-paste(name_list[[1]][i],"POST",sep = "_")
New_list<-c(New_list,Temp_PRE)
New_list<-c(New_list,Temp)
New_list<-c(New_list,Temp_POST)
New_names<-c(New_names,Temp_PRE)
New_names<-c(New_names,Temp)
New_names<-c(New_names,Temp_POST)
}
for (i in 1:length(New_list)){
Newdata[[1+i]]<-0
New_names[i+1]<-New_list[i]
}
names(Newdata)<-New_names
sequence<-c()
for (i in 1:length(New_names)){
for (t in 1:length(name_list[[1]])){
if (New_names[i]==name_list[[1]][t]){
sequence<-c(sequence,i)
}
}
}
raw_data$Date<-as.Date(raw_data$Date)
for (t in 1:length(raw_data[[1]])){
for (i in 1:length(Newdata[[1]])){
cal<-raw_data[[2]][t]-Newdata[[1]][i]
temp_col<-raw_data[[9]][t]
if (cal>=0&cal<=6){
for (l in 1:length(name_list[[1]])){
if (name_list[[1]][l]==temp_col) {
num<-sequence[l]
Newdata[[num]][i]<-1
}
}
}
}
}
for (i in 1:length(Newdata[[1]])){
for (t in 1:length(name_list[[1]])){
if (Newdata[[sequence[t]]][i]==1){
Newdata[[sequence[t]+1]][i+1]<-1
Newdata[[sequence[t]-1]][i-1]<-1
}
}
}
return(Newdata)
}
Data_for_write<-data_filter_CN_week(raw_data,name_list,begin_data)
write.csv(Data_for_write,file = "./Holiday_week_back_up/China_Modeling_week.csv" )
source('~/External_factor_cleaning/Function.R', echo=TRUE)
e<-Holiday_data_cleaning("China",Developer = T,Date_option=T,"2010-10-10")
source('~/DDI_Model/StepReg2.R', echo=TRUE)
StepReg2()
source('~/External_factor_cleaning/Function.R', echo=TRUE)
source('~/External_factor_cleaning/Main.R', echo=TRUE)
